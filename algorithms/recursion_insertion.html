<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Linear Recurrence Tree Visualizer</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
    }

    h2 {
        text-align: center;
        margin: 12px 0;
    }

    .controls {
        text-align: center;
        margin-bottom: 10px;
    }

    input {
        width: 220px;
        padding: 6px;
        font-size: 16px;
        text-align: center;
    }

    button {
        padding: 7px 14px;
        font-size: 15px;
        margin: 0 4px;
        cursor: pointer;
    }

    .equation {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .container {
        display: flex;
        height: 650px;
    }

    .tree-view {
        width: 90%;
        background: white;
        border-right: 1px solid #ccc;
    }

    .level-view {
        width: 10%;
        background: #fafafa;
        padding: 10px;
        font-size: 14px;
        overflow-y: auto;
    }

    svg {
        width: 100%;
        height: 100%;
    }

    /* white fill + white border */
    circle {
        fill: white;
        stroke: white;
        stroke-width: 2;
    }

    text {
        fill: black;
        font-size: 16px;
        font-weight: bold;
        text-anchor: middle;
        dominant-baseline: middle;
        pointer-events: none;
    }

    line {
        stroke: black;
        stroke-width: 1.5;
    }

    .level-item {
        margin-bottom: 8px;
        border-bottom: 1px solid #ddd;
        padding-bottom: 4px;
    }
</style>
</head>

<body>

<h2>Linear Recurrence Tree Visualizer</h2>

<div class="controls">
    T(n) =
    <input id="termInput" placeholder="Enter T(n-1) and cn">
    <button onclick="addTerm()">Add</button>
    <button onclick="nextStep()">Next</button>
    <button onclick="resetAll()">Reset</button>
</div>

<div class="equation" id="equation">T(n) =</div>

<div class="container">
    <div class="tree-view">
        <svg id="tree"></svg>
    </div>
    <div class="level-view">
        <h3>Level Cost</h3>
        <div id="levels"></div>
    </div>
</div>

<script>
const svg = document.getElementById("tree");
const equationDiv = document.getElementById("equation");
const levelsDiv = document.getElementById("levels");

const nodeRadius = 22;
const levelHeight = 90;

let hasRecurrence = false;
let hasCost = false;

let node = null;   // single active node
let level = 0;

/* ---------- INPUT ---------- */

function addTerm() {
    const input = document.getElementById("termInput");
    const term = input.value.trim();

    if (term === "T(n-1)") hasRecurrence = true;
    if (term === "cn") hasCost = true;

    updateEquation();
    input.value = "";
}

function updateEquation() {
    const parts = [];
    if (hasRecurrence) parts.push("T(n-1)");
    if (hasCost) parts.push("cn");
    equationDiv.textContent = "T(n) = " + parts.join(" + ");
}

/* ---------- STEP LOGIC ---------- */

function nextStep() {
    if (!hasRecurrence || !hasCost) return;

    // Step 1: just show T(n)
    if (level === 0) {
        const w = svg.clientWidth;
        node = { x: w / 2, y: 40, label: "n", kind: "T" };
        drawNode(node.x, node.y, "T(n)");
        level++;
        return;
    }

    // Convert current T(...) -> c(...)
    if (node.kind === "T") {
        updateNodeText(node, formatCost(node.label));
        addLevelSum(formatCost(node.label));
        node.kind = "c";
    }

    // Create next T(...) child
    const newLabel = decrement(node.label);
    const x = node.x;
    const y = node.y + levelHeight;

    drawEdge(node.x, node.y, x, y);
    drawNode(x, y, `T(${newLabel})`);

    node = { x, y, label: newLabel, kind: "T" };
    level++;
}

/* ---------- LABEL HELPERS ---------- */

function decrement(label) {
    if (label === "n") return "n-1";
    const m = label.match(/^n-(\d+)$/);
    return `n-${parseInt(m[1]) + 1}`;
}

function formatCost(label) {
    return label === "n" ? "cn" : `c(${label})`;
}

/* ---------- RIGHT VIEW ---------- */

function addLevelSum(expr) {
    const div = document.createElement("div");
    div.className = "level-item";
    div.textContent = `Level ${levelsDiv.children.length + 1}: ${expr}`;
    levelsDiv.appendChild(div);
}

/* ---------- SVG ---------- */

function drawEdge(x1, y1, x2, y2) {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", x1);
    line.setAttribute("y1", y1 + nodeRadius);
    line.setAttribute("x2", x2);
    line.setAttribute("y2", y2 - nodeRadius);
    svg.appendChild(line);
}

function drawNode(x, y, label) {
    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    c.setAttribute("cx", x);
    c.setAttribute("cy", y);
    c.setAttribute("r", nodeRadius);

    const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
    t.setAttribute("x", x);
    t.setAttribute("y", y);
    t.textContent = label;

    g.appendChild(c);
    g.appendChild(t);
    svg.appendChild(g);
}

function updateNodeText(node, text) {
    const texts = svg.getElementsByTagName("text");
    for (let t of texts) {
        if (+t.getAttribute("x") === node.x && +t.getAttribute("y") === node.y) {
            t.textContent = text;
            break;
        }
    }
}

/* ---------- RESET ---------- */

function resetAll() {
    hasRecurrence = false;
    hasCost = false;
    node = null;
    level = 0;
    svg.innerHTML = "";
    levelsDiv.innerHTML = "";
    equationDiv.textContent = "T(n) =";
}
</script>

</body>
</html>
